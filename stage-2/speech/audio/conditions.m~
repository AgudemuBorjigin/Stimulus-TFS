% mixing target and masker for different configurations
fs = 44100;
rampdur = 0.01;
t_onset = 0.7;
% CHANGE AS NEEDED
root_audios = '/Users/baoagudemu1/Desktop/Lab/Experiment/speechAudiofiles_stage2';

conds = {'echo-pitch', 'echo-space', 'echo', 'echo-sum', 'pitch', 'space', 'anechoic', 'sum'};
%SNRs = {15:-6:-21, 15:-6:-21, 15:-6:-21, 12:-6:-24, 8:-5:-22, 8:-5:-22, 8:-5:-22, 8:-5:-22};
% make sure every number is divisible by 4 
% Ns = {[24, 36, 36, 36, 36, 36, 24], [24, 36, 36, 36, 36, 36, 24], [24, 36, 36, 36, 36, 36, 24],...
%       [24, 36, 36, 36, 36, 36, 24], [24, 36, 36, 36, 36, 36, 24], [24, 36, 36, 36, 36, 36, 24],...
%       [24, 36, 36, 36, 36, 36, 24], [24, 36, 36, 36, 36, 36, 24]};
SNRs = {-6, -6, -6, -6, -6, -6, -6, -6};
Ns = {10, 10, 10, 10, 10, 10, 10, 10};

num_total = 0;

for i = 1:numel(Ns)
    num_total = num_total + sum(Ns{i});
end

num_visits = 1;
numPerVisit = num_total/num_visits;
for v = 1:num_visits
    count = 0;
    num_trial = 0;
    rand_trialnums = randperm(numPerVisit);
    for i = 1:numel(conds)
        configuration = conds{i};
        snrs = SNRs{i};
        ns = Ns{i}/num_visits;
        count = sum(ns) + count;
        target_masker(sum(ns), count);
        gender = 'same_gender';
        b_same = filter_param(sum(ns), count, gender, strcat(root_audios, '/target_masker/', gender, '/'), fs);
        gender = 'opposite_gender';
        b_opposite = filter_param(sum(ns), count, gender, strcat(root_audios, '/target_masker/', gender, '/'), fs);
        
        for j = 1:numel(snrs)
            for k = 1:ns(j)
                num_trial = num_trial + 1;
                switch configuration
                    case {'echo-pitch', 'echo-sum', 'pitch', 'sum'}
                        load(strcat(root_audios, '/target_masker/opposite_gender/trial', int2str(num_trial), '.mat'));
                        stim_bck = stim_opposite; b = b_opposite;
                    otherwise
                        load(strcat(root_audios, '/target_masker/same_gender/trial', int2str(num_trial), '.mat'));
                        stim_bck = stim_same; b = b_same;
                end
                mixture(stim_tar, stim_bck, b, configuration, snrs(j),  int2str(rand_trialnums(num_trial)), target, wordlist, t_onset, fs, rampdur, root_audios, v);
                info{rand_trialnums(num_trial), 3} = configuration;
                info{rand_trialnums(num_trial), 2} = snrs(j);
                info{rand_trialnums(num_trial), 1} = target;
            end
        end
    end
    fid = fopen(strcat(root_audios, '/mixture/', 'visit-', num2str(v), '/stimulus-ref.xls'),'wt');
    for i = 1:num_trial
        fprintf(fid,'%d,%s\n',info{i,1}, info{i,3});
    end
    fclose(fid);
end